!function(){"use strict";var n={d:function(r,t){for(var e in t)n.o(t,e)&&!n.o(r,e)&&Object.defineProperty(r,e,{enumerable:!0,get:t[e]})},o:function(n,r){return Object.prototype.hasOwnProperty.call(n,r)}},r={};function t(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=new Array(r);t<r;t++)e[t]=n[t];return e}function e(n){return function(n){if(Array.isArray(n))return t(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,r){if(n){if("string"===typeof n)return t(n,r);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(n):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?t(n,r):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(r,{asyncChances:function(){return x}});var o=function(n){var r={};return n.forEach((function(n){r[n]?r[n]+=1:r[n]=1})),i(n.length)/Object.values(r).reduce((function(n,r){return n*i(r)}),1)},i=function n(r){if(r<0)throw new Error("n must be >= 0");return 0===r?1:r*n(r-1)},u=function(n){return 0===n?.5:Math.pow(1/6,n-1)*(1/3+1/6*.5)},c=function(n){return 0===n?5/12:Math.pow(1/6,n-1)*(5/12+1/6*(5/12))},a=function(n){return 0===n?5/6:1===n?1/6:0},s=function(n){return 0===n?2/3:Math.pow(1/12,n-1)*(1/4+1/12*(2/3))},l=function(n){var r=n.ring,t=n.skill,o=n.n,i=n.keptDiceCount,u=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.maxCardinality,o=void 0===t?null:t,i=r.maxValue,u=void 0===i?null:i,c=[];return function r(t){if(!(null!==o&&t.length>o)&&(null===u||!t.some((function(n){return n>u})))){var i=t.reduce((function(n,r){return n+r}),0);if(i<n){var a=[].concat(e(t),[1]),s=e(t);s[s.length-1]=s[s.length-1]+1,r(a),r(s)}i===n&&c.push(t)}}([1]),c}(o,{maxCardinality:void 0===i?r:i}),c=[];return u.forEach((function(n){var o=function(n){var r=n.ring,t=n.skill,o=n.size;if(o>r.length+t.length)throw new Error("Out of bounds");if(r<1)throw new Error("Not possible for a standard roll thus not implemented");var i=[];return function n(u){u.length<o&&(u.filter((function(n){return"r"===n})).length<r&&n([].concat(e(u),["r"])),u.filter((function(n){return"s"===n})).length<t&&n([].concat(e(u),["s"]))),u.length===o&&i.push(u)}([]),h(i.map((function(n){return e(n).sort()}))).map((function(n){return{ring:n.filter((function(n){return"r"===n})).length,skill:n.filter((function(n){return"s"===n})).length}}))}({ring:r,skill:t,size:n.length});o.forEach((function(r){for(var t=r.ring,e=r.skill,o=new Array(t),i=new Array(e),u=0;u<t;u++)o[u]=n[u];for(var a=0;a<e;a++)i[a]=n[t+a];c.push({rings:o,skills:i})}))})),c},f=function(n){for(var r=n.threshold,t=n.size,o={1:[]},i=1;i<=r;i++)o[1].push([i]);for(var u=2;u<=t;u++){o[u]=[];for(var c=1;c<=r;c++)for(var a=0;a<o[u-1].length;a++)o[u-1][a][0]<c||o[u].push([c].concat(e(o[u-1][a])))}for(var s=[new Array(t).fill(0)],l=function(n){o[n].forEach((function(r){s.push([].concat(e(new Array(t-n).fill(0)),e(r)))}))},f=1;f<=t;f++)l(f);return s},p=function(n,r){if(n.length!==r.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==r[t])return!1;return!0},h=function(n){for(var r=e(n).map((function(n){return n.sort()})),t=[],o=[],i=0;i<r.length;i++)if(!o.includes(i)){for(var u=i+1;u<n.length;u++)p(r[i],r[u])&&o.push(u);t.push(r[i])}return t},g=function(n){var r=n.comb,t=n.diceP,i=n.diceCount;if(r.length>i)return 0;var u=1;return r.forEach((function(n){u*=t(n)})),u*=Math.pow(t(0),i-r.length),u*=o([].concat(e(r),e(new Array(i-r.length).fill(0))))},v=function(n,r){return n.reduce((function(n,t){return n*r(t)}),1)},d=function(n,r){var t=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).max,o=void 0===t?null:t;return null===o?n.reduce((function(n,r){return n+r}),0)>=r:e(n).sort().reverse().slice(0,o).reduce((function(n,r){return n+r}),0)>=r},m=function(n){var r=n.ring,t=n.skill,i=n.tn,h=n.options,m=h.compromised,k=void 0!==m&&m,y=h.keptDiceCount,w=void 0===y?r:y,M=k?a:u,C=k?s:c;if(0===i)return Math.pow(M(0),r)*Math.pow(C(0),t);var b=function(n){for(var r=n.ring,t=n.skill,e=n.n,o=n.keptDiceCount,i=l({ring:r,skill:t,n:e,keptDiceCount:o}).map((function(n){var r=n.rings,t=n.skills;return{rings:r.sort(),skills:t.sort()}})),u=[],c=[],a=0;a<i.length;a++)if(!c.includes(a)){for(var s=a+1;s<i.length;s++)p(i[a].rings,i[s].rings)&&p(i[a].skills,i[s].skills)&&c.push(s);u.push(i[a])}return u}({ring:r,skill:t,n:i,keptDiceCount:w}),E=b.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length<w})).reduce((function(n,e){var o=e.rings,i=e.skills;return n+g({comb:o,diceP:M,diceCount:r})*g({comb:i,diceP:C,diceCount:t})}),0),D=b.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length===w})),A=D.filter((function(n){return 0===n.skills.length})).reduce((function(n,r){var i=r.rings,u=1;return u*=v(i,M),u*=o(i),u*=f({threshold:Math.min.apply(Math,e(i)),size:t}).reduce((function(n,r){return n+v(r,C)*o(r)}),0),n+u}),0),P=D.filter((function(n){return 0===n.rings.length})).reduce((function(n,u){var c=u.skills,a=1;return a*=f({threshold:Math.min.apply(Math,e(c)),size:r}).filter((function(n){return!d(n,i)})).reduce((function(n,r){return n+v(r,M)*o(r)}),0),a*=v(c,C),a*=f({threshold:Math.min.apply(Math,e(c)),size:t-c.length}).reduce((function(n,r){return n+v(r,C)*o([].concat(e(c),e(r)))}),0),n+a}),0),z=D.filter((function(n){var r=n.rings,t=n.skills;return r.length>0&&t.length>0})),j=[],x=function(n){j.some((function(r){var t=r.rings,o=r.skills;return p(e(t).sort(),e(n.rings).sort())&&p(e(o).sort(),e(n.skills).sort())}))||j.push(n)};return z.forEach((function(n){var o=n.rings,u=n.skills,c=Math.min.apply(Math,e(o).concat(e(u)));f({threshold:c,size:r-o.length}).map((function(n){return[].concat(e(o),e(n))})).filter((function(n){return!d(n,i)})).forEach((function(n){if(t===u.length)return x({rings:n,skills:u});f({threshold:c,size:t-u.length}).map((function(n){return[].concat(e(u),e(n))})).filter((function(n){return!d(n,i,{max:w})})).forEach((function(r){x({rings:n,skills:r})}))}))})),E+A+P+j.reduce((function(n,r){var t=r.rings,e=r.skills;return n+v(t,M)*o(t)*v(e,C)*o(e)}),0)},k=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/3:1/6:0===t?Math.pow(1/6,r-1)*(1/3+1/6*(1/6)):Math.pow(1/6,r)*(1/3)},y=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?.4*Math.pow(1/6,r):0===r?.6:Math.pow(1/6,r-1)*(1/3+1/6*.6)},w=function(n){var r=n.n,t=n.opp;return 0===t&&0===r?2/3:1===t&&0===r||0===t&&1===r?1/6:0},M=function(n){var r=n.n,t=n.opp;return 0===t&&0===r?5/6:1===t&&0===r||0===t&&1===r?1/6:0},C=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/4:1/6:0===t?Math.pow(1/6,r-1)*(1/3+1/6*(1/6)):.125*Math.pow(1/6,r-1)},b=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?.15*Math.pow(1/6,r-1):0===r?.6:Math.pow(1/6,r-1)*(1/3+1/6*.6)},E=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/4:1/6:0===t?Math.pow(1/12,r-1)*(1/6+1/12*(5/12)):Math.pow(1/12,r-1)*(1/12+1/12*(1/4))},D=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?Math.pow(1/12,r-1)*(1/12+1/12*(4/11)):0===r?1-4/11:Math.pow(1/12,r-1)*(1/6+1/12*(1-4/11))},A=function(n){var r=n.totalDiceCount,t=n.min,o=n.max,i=[];return function n(u){if(!(u.length>r)&&!u.some((function(n){return n>1}))){if(u.length===r){var c=u.reduce((function(n,r){return n+r}),0);c>=t&&(!o||c<=o)&&i.push(u)}var a=[].concat(e(u),[0]),s=e(u);s[s.length-1]=s[s.length-1]+1,n(a),n(s)}}([0]),i},P=function(n,r){var t=n.success,e=n.opportunity,o=r.success,i=r.opportunity;return o-t||i-e},z=function(n){return o(n.map((function(n){var r=n.success,t=n.opportunity;return"".concat(r,"-").concat(t)})))},j=function(n){var r=n.ring,t=n.skill,o=n.tn,i=n.opp,u=void 0===i?0:i,c=n.options,a=void 0===c?{}:c;if(0===u)return function(n){var r=n.ring,t=n.skill,e=n.tn,o=n.options,i=void 0===o?{}:o,u=i.keptDiceCount,c=void 0===u?r:u;if(c<=0)return e<=0?1:0;if(c>r+t)throw new Error("Cannot keep more dice than available");if(c<r)throw new Error("Not implemented");for(var a=1,s=0;s<e;s++)a-=m({ring:r,skill:t,tn:s,options:i});return a}({ring:r,skill:t,tn:o,options:a});var s=a.compromised,l=void 0!==s&&s,p=a.keptDiceCount,h=void 0===p?r:p;if(u>h)return 0;var g=l?M:y,v=l?w:k,d=l?D:b,j=l?E:C;return function(n){var r=n.ring,t=n.skill,o=n.tn,i=n.keptDiceCount,u=n.opp,c=A({totalDiceCount:r+t,min:i,max:i}),a=function(n){if(0===n)return[[]];var r=[],t=A({totalDiceCount:n,min:0});return f({threshold:o,size:n}).forEach((function(e){t.forEach((function(t){for(var o=new Array(n),i=0;i<n;i++)o[i]={success:e[i],opportunity:t[i]};o.sort(P),r.some((function(n){return t=o,(r=n).length===t.length&&r.every((function(n,r){var e=n.success,o=n.opportunity;return t[r].success===e&&t[r].opportunity===o}));var r,t}))||r.push(o)}))})),r},s=a(r),l=a(t),p=[];return s.forEach((function(n){l.forEach((function(r){for(var t,i=[].concat(e(n),e(r)),a=function(){var t=c[s];return i.reduce((function(n,r,e){return n+r.success*t[e]}),0)<o||i.reduce((function(n,r,e){return n+r.opportunity*t[e]}),0)<u?0:(p.push({ringDice:n,skillDice:r}),1)},s=0;s<c.length&&(0===(t=a())||1!==t);s++);}))})),p}({ring:r,skill:t,tn:o,keptDiceCount:h,opp:u}).reduce((function(n,r){var t=r.ringDice,e=r.skillDice;return n+z(t)*t.reduce((function(n,r){var t=r.success,e=r.opportunity;return n*(t===o?g({n:t,opp:e}):v({n:t,opp:e}))}),1)*z(e)*e.reduce((function(n,r){var t=r.success,e=r.opportunity;return n*(t===o?d({n:t,opp:e}):j({n:t,opp:e}))}),1)}),0)},x=function(n){postMessage({type:"custom",params:n,result:j(n)})};addEventListener("message",(function(n){var t,e=n.data,o=e.type,i=e.method,u=e.id,c=e.params;"RPC"===o&&i&&((t=r[i])?Promise.resolve().then((function(){return t.apply(r,c)})):Promise.reject("No such method")).then((function(n){postMessage({type:"RPC",id:u,result:n})})).catch((function(n){var r={message:n};n.stack&&(r.message=n.message,r.stack=n.stack,r.name=n.name),postMessage({type:"RPC",id:u,error:r})}))})),postMessage({type:"RPC",method:"ready"})}();
//# sourceMappingURL=c247fb8e13969ddae1ea.worker.js.map
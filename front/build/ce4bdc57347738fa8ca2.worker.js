!function(n){var r={};function t(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return n[e].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=n,t.c=r,t.d=function(n,r,e){t.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:e})},t.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,r){if(1&r&&(n=t(n)),8&r)return n;if(4&r&&"object"===typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&r&&"string"!=typeof n)for(var o in n)t.d(e,o,function(r){return n[r]}.bind(null,o));return e},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},t.p="/react/",t(t.s=0)}([function(n,r,t){"use strict";function e(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=new Array(r);t<r;t++)e[t]=n[t];return e}function o(n){return function(n){if(Array.isArray(n))return e(n)}(n)||function(n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||function(n,r){if(n){if("string"===typeof n)return e(n,r);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t.r(r),t.d(r,"asyncChances",(function(){return S}));var i=function(n){var r={};return n.forEach((function(n){r[n]?r[n]+=1:r[n]=1})),u(n.length)/Object.values(r).reduce((function(n,r){return n*u(r)}),1)},u=function n(r){if(r<0)throw new Error("n must be >= 0");return 0===r?1:r*n(r-1)},c=function(n){return 0===n?.5:Math.pow(1/6,n-1)*(1/3+1/6*.5)},a=function(n){return 0===n?5/12:Math.pow(1/6,n-1)*(5/12+1/6*(5/12))},s=function(n){return 0===n?5/6:1===n?1/6:0},l=function(n){return 0===n?2/3:Math.pow(1/12,n-1)*(1/4+1/12*(2/3))},f=function(n){var r=n.ring,t=n.skill,e=n.n,i=n.keptDiceCount,u=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.maxCardinality,e=void 0===t?null:t,i=r.maxValue,u=void 0===i?null:i,c=[];return function r(t){if(!(null!==e&&t.length>e)&&(null===u||!t.some((function(n){return n>u})))){var i=t.reduce((function(n,r){return n+r}),0);if(i<n){var a=[].concat(o(t),[1]),s=o(t);s[s.length-1]=s[s.length-1]+1,r(a),r(s)}i===n&&c.push(t)}}([1]),c}(e,{maxCardinality:void 0===i?r:i}),c=[];return u.forEach((function(n){(function(n){var r=n.ring,t=n.skill,e=n.size;if(e>r.length+t.length)throw new Error("Out of bounds");if(r<1)throw new Error("Not possible for a standard roll thus not implemented");var i=[];return function n(u){u.length<e&&(u.filter((function(n){return"r"===n})).length<r&&n([].concat(o(u),["r"])),u.filter((function(n){return"s"===n})).length<t&&n([].concat(o(u),["s"]))),u.length===e&&i.push(u)}([]),v(i.map((function(n){return o(n).sort()}))).map((function(n){return{ring:n.filter((function(n){return"r"===n})).length,skill:n.filter((function(n){return"s"===n})).length}}))})({ring:r,skill:t,size:n.length}).forEach((function(r){for(var t=r.ring,e=r.skill,o=new Array(t),i=new Array(e),u=0;u<t;u++)o[u]=n[u];for(var a=0;a<e;a++)i[a]=n[t+a];c.push({rings:o,skills:i})}))})),c},p=function(n){for(var r=n.threshold,t=n.size,e={1:[]},i=1;i<=r;i++)e[1].push([i]);for(var u=2;u<=t;u++){e[u]=[];for(var c=1;c<=r;c++)for(var a=0;a<e[u-1].length;a++)e[u-1][a][0]<c||e[u].push([c].concat(o(e[u-1][a])))}for(var s=[new Array(t).fill(0)],l=function(n){e[n].forEach((function(r){s.push([].concat(o(new Array(t-n).fill(0)),o(r)))}))},f=1;f<=t;f++)l(f);return s},h=function(n,r){if(n.length!==r.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==r[t])return!1;return!0},v=function(n){for(var r=o(n).map((function(n){return n.sort()})),t=[],e=[],i=0;i<r.length;i++)if(!e.includes(i)){for(var u=i+1;u<n.length;u++)h(r[i],r[u])&&e.push(u);t.push(r[i])}return t},g=function(n){var r=n.comb,t=n.diceP,e=n.diceCount;if(r.length>e)return 0;var u=1;return r.forEach((function(n){u*=t(n)})),u*=Math.pow(t(0),e-r.length),u*=i([].concat(o(r),o(new Array(e-r.length).fill(0))))},d=function(n,r){return n.reduce((function(n,t){return n*r(t)}),1)},m=function(n,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=t.max,i=void 0===e?null:e;return null===i?n.reduce((function(n,r){return n+r}),0)>=r:o(n).sort().reverse().slice(0,i).reduce((function(n,r){return n+r}),0)>=r},y=function(n){var r=n.ring,t=n.skill,e=n.tn,u=n.options,v=u.compromised,y=void 0!==v&&v,k=u.keptDiceCount,w=void 0===k?r:k,M=y?s:c,b=y?l:a;if(0===e)return Math.pow(M(0),r)*Math.pow(b(0),t);var C=function(n){for(var r=n.ring,t=n.skill,e=n.n,o=n.keptDiceCount,i=f({ring:r,skill:t,n:e,keptDiceCount:o}).map((function(n){var r=n.rings,t=n.skills;return{rings:r.sort(),skills:t.sort()}})),u=[],c=[],a=0;a<i.length;a++)if(!c.includes(a)){for(var s=a+1;s<i.length;s++)h(i[a].rings,i[s].rings)&&h(i[a].skills,i[s].skills)&&c.push(s);u.push(i[a])}return u}({ring:r,skill:t,n:e,keptDiceCount:w}),E=C.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length<w})).reduce((function(n,e){var o=e.rings,i=e.skills;return n+g({comb:o,diceP:M,diceCount:r})*g({comb:i,diceP:b,diceCount:t})}),0),D=C.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length===w})),P=D.filter((function(n){return 0===n.skills.length})).reduce((function(n,r){var e=r.rings,u=1;return u*=d(e,M),u*=i(e),n+(u*=p({threshold:Math.min.apply(Math,o(e)),size:t}).reduce((function(n,r){return n+d(r,b)*i(r)}),0))}),0),j=D.filter((function(n){return 0===n.rings.length})).reduce((function(n,u){var c=u.skills,a=1;return a*=p({threshold:Math.min.apply(Math,o(c)),size:r}).filter((function(n){return!m(n,e)})).reduce((function(n,r){return n+d(r,M)*i(r)}),0),a*=d(c,b),n+(a*=p({threshold:Math.min.apply(Math,o(c)),size:t-c.length}).reduce((function(n,r){return n+d(r,b)*i([].concat(o(c),o(r)))}),0))}),0),A=D.filter((function(n){var r=n.rings,t=n.skills;return r.length>0&&t.length>0})),x=[],O=function(n){x.some((function(r){var t=r.rings,e=r.skills;return h(o(t).sort(),o(n.rings).sort())&&h(o(e).sort(),o(n.skills).sort())}))||x.push(n)};return A.forEach((function(n){var i=n.rings,u=n.skills,c=Math.min.apply(Math,o(i).concat(o(u)));p({threshold:c,size:r-i.length}).map((function(n){return[].concat(o(i),o(n))})).filter((function(n){return!m(n,e)})).forEach((function(n){if(t===u.length)return O({rings:n,skills:u});p({threshold:c,size:t-u.length}).map((function(n){return[].concat(o(u),o(n))})).filter((function(n){return!m(n,e,{max:w})})).forEach((function(r){O({rings:n,skills:r})}))}))})),E+P+j+x.reduce((function(n,r){var t=r.rings,e=r.skills;return n+d(t,M)*i(t)*d(e,b)*i(e)}),0)},k=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/3:1/6:0===t?Math.pow(1/6,r-1)*(1/3+1/6*(1/6)):Math.pow(1/6,r)*(1/3)},w=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?.4*Math.pow(1/6,r):0===r?.6:Math.pow(1/6,r-1)*(1/3+1/6*.6)},M=function(n){var r=n.n,t=n.opp;return 0===t&&0===r?2/3:1===t&&0===r||0===t&&1===r?1/6:0},b=function(n){var r=n.n,t=n.opp;return 0===t&&0===r?5/6:1===t&&0===r||0===t&&1===r?1/6:0},C=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/4:1/6:0===t?Math.pow(1/6,r-1)*(1/3+1/6*(1/6)):.125*Math.pow(1/6,r-1)},E=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?.15*Math.pow(1/6,r-1):0===r?.6:Math.pow(1/6,r-1)*(1/3+1/6*.6)},D=function(n){var r=n.n,t=n.opp;return t>1?0:0===r?1===t?1/4:1/6:0===t?Math.pow(1/12,r-1)*(1/6+1/12*(5/12)):Math.pow(1/12,r-1)*(1/12+1/12*(1/4))},P=function(n){var r=n.n,t=n.opp;return t>1?0:1===t?Math.pow(1/12,r-1)*(1/12+1/12*(4/11)):0===r?1-4/11:Math.pow(1/12,r-1)*(1/6+1/12*(1-4/11))},j=function(n){var r=n.totalDiceCount,t=n.min,e=n.max,i=[];return function n(u){if(!(u.length>r)&&!u.some((function(n){return n>1}))){if(u.length===r){var c=u.reduce((function(n,r){return n+r}),0);c>=t&&(!e||c<=e)&&i.push(u)}var a=[].concat(o(u),[0]),s=o(u);s[s.length-1]=s[s.length-1]+1,n(a),n(s)}}([0]),i},A=function(n,r){var t=n.success,e=n.opportunity,o=r.success,i=r.opportunity;return o-t||i-e},x=function(n){return i(n.map((function(n){var r=n.success,t=n.opportunity;return"".concat(r,"-").concat(t)})))},O=function(n){var r=n.ring,t=n.skill,e=n.tn,i=n.opp,u=void 0===i?0:i,c=n.options,a=void 0===c?{}:c;if(0===u)return function(n){var r=n.ring,t=n.skill,e=n.tn,o=n.options,i=void 0===o?{}:o,u=i.keptDiceCount,c=void 0===u?r:u;if(c<=0)return e<=0?1:0;if(c>r+t)throw new Error("Cannot keep more dice than available");if(c<r)throw new Error("Not implemented");for(var a=1,s=0;s<e;s++)a-=y({ring:r,skill:t,tn:s,options:i});return a}({ring:r,skill:t,tn:e,options:a});var s=a.compromised,l=void 0!==s&&s,f=a.keptDiceCount,h=void 0===f?r:f;if(u>h)return 0;var v=l?b:w,g=l?M:k,d=l?P:E,m=l?D:C;return function(n){var r=n.ring,t=n.skill,e=n.tn,i=n.keptDiceCount,u=n.opp,c=j({totalDiceCount:r+t,min:i,max:i}),a=function(n){if(0===n)return[[]];var r=[],t=j({totalDiceCount:n,min:0});return p({threshold:e,size:n}).forEach((function(e){t.forEach((function(t){for(var o=new Array(n),i=0;i<n;i++)o[i]={success:e[i],opportunity:t[i]};o.sort(A),r.some((function(n){return t=o,(r=n).length===t.length&&r.every((function(n,r){var e=n.success,o=n.opportunity;return t[r].success===e&&t[r].opportunity===o}));var r,t}))||r.push(o)}))})),r},s=a(r),l=a(t),f=[];return s.forEach((function(n){l.forEach((function(r){for(var t=[].concat(o(n),o(r)),i=function(o){var i=c[o];return t.reduce((function(n,r,t){return n+r.success*i[t]}),0)<e||t.reduce((function(n,r,t){return n+r.opportunity*i[t]}),0)<u?"continue":(f.push({ringDice:n,skillDice:r}),"break")},a=0;a<c.length;a++){var s=i(a);if("continue"!==s&&"break"===s)break}}))})),f}({ring:r,skill:t,tn:e,keptDiceCount:h,opp:u}).reduce((function(n,r){var t=r.ringDice,o=r.skillDice;return n+x(t)*t.reduce((function(n,r){var t=r.success,o=r.opportunity;return n*(t===e?v({n:t,opp:o}):g({n:t,opp:o}))}),1)*x(o)*o.reduce((function(n,r){var t=r.success,o=r.opportunity;return n*(t===e?d({n:t,opp:o}):m({n:t,opp:o}))}),1)}),0)},S=function(n){postMessage({type:"custom",params:n,result:O(n)})};addEventListener("message",(function(n){var t,e=n.data,o=e.type,i=e.method,u=e.id,c=e.params;"RPC"===o&&i&&((t=r[i])?Promise.resolve().then((function(){return t.apply(r,c)})):Promise.reject("No such method")).then((function(n){postMessage({type:"RPC",id:u,result:n})})).catch((function(n){var r={message:n};n.stack&&(r.message=n.message,r.stack=n.stack,r.name=n.name),postMessage({type:"RPC",id:u,error:r})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=ce4bdc57347738fa8ca2.worker.js.map
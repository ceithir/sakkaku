import { getProbability } from "./probabilities";

describe("getProbability", () => {
  test("classic", () => {
    expect(getP({ roll: 3, keep: 2, tn: 15 })).toEqual(47);
    expect(getP({ roll: 7, keep: 4, tn: 30 })).toEqual(63);
  });
  test("no explosion", () => {
    expect(getP({ roll: 3, keep: 2, tn: 15, explosions: [] })).toEqual(43);
    expect(getP({ roll: 7, keep: 4, tn: 30, explosions: [] })).toEqual(53);
  });
  test("explode on both 9 and 10", () => {
    expect(getP({ roll: 3, keep: 2, tn: 15, explosions: [9, 10] })).toEqual(54);
    expect(getP({ roll: 7, keep: 4, tn: 30, explosions: [9, 10] })).toEqual(74);
  });
  test("emphasises", () => {
    expect(getP({ roll: 3, keep: 2, tn: 15, rerolls: [1] })).toEqual(53);
    expect(getP({ roll: 7, keep: 4, tn: 30, rerolls: [1] })).toEqual(70);
  });
  test("emphasises and explode on both 9 and 10", () => {
    expect(
      getP({
        roll: 3,
        keep: 2,
        tn: 15,
        explosions: [9, 10],
        rerolls: [1],
      })
    ).toEqual(59);
    expect(
      getP({
        roll: 7,
        keep: 4,
        tn: 30,
        explosions: [9, 10],
        rerolls: [1],
      })
    ).toEqual(80);
  });
});

const rawData = {
  "3k2": [
    [1, 0],
    [2, 0.09893],
    [3, 0.30219],
    [4, 0.70461],
    [5, 1.20374],
    [6, 1.90715],
    [7, 2.70747],
    [8, 3.70347],
    [9, 4.79995],
    [10, 6.09625],
    [11, 7.21347],
    [12, 7.93206],
    [13, 8.22343],
    [14, 8.16211],
    [15, 7.67683],
    [16, 6.84443],
    [17, 5.57016],
    [18, 3.9718],
    [19, 1.91793],
    [20, 2.42242],
    [21, 2.40298],
    [22, 2.33492],
    [23, 2.22479],
    [24, 2.05815],
    [25, 1.83106],
    [26, 1.56405],
    [27, 1.234],
    [28, 0.84866],
    [29, 0.41523],
    [30, 0.49183],
    [31, 0.46444],
    [32, 0.43155],
    [33, 0.40125],
    [34, 0.35803],
    [35, 0.30902],
    [36, 0.25712],
    [37, 0.19733],
    [38, 0.13426],
    [39, 0.06459],
    [40, 0.07483],
    [41, 0.06977],
    [42, 0.06309],
    [43, 0.05728],
    [44, 0.05029],
    [45, 0.04278],
    [46, 0.03677],
    [47, 0.02746],
    [48, 0.01903],
    [49, 0.00838],
    [50, 0.00978],
  ],

  "3k2e": [
    [1, 0],
    [2, 0],
    [3, 0.00346],
    [4, 0.17327],
    [5, 0.47728],
    [6, 1.05019],
    [7, 1.73682],
    [8, 2.70885],
    [9, 3.81648],
    [10, 5.18954],
    [11, 6.67395],
    [12, 7.97467],
    [13, 8.6572],
    [14, 8.89333],
    [15, 8.49254],
    [16, 7.69495],
    [17, 6.30012],
    [18, 4.44357],
    [19, 2.00529],
    [20, 2.6076],
    [21, 2.61413],
    [22, 2.59182],
    [23, 2.50851],
    [24, 2.34189],
    [25, 2.12196],
    [26, 1.81146],
    [27, 1.44281],
    [28, 0.98975],
    [29, 0.46519],
    [30, 0.56048],
    [31, 0.53052],
    [32, 0.49646],
    [33, 0.46288],
    [34, 0.41645],
    [35, 0.36435],
    [36, 0.29957],
    [37, 0.23356],
    [38, 0.15934],
    [39, 0.07484],
    [40, 0.08967],
    [41, 0.08163],
    [42, 0.07567],
    [43, 0.06824],
    [44, 0.05935],
    [45, 0.05146],
    [46, 0.04237],
    [47, 0.03312],
    [48, 0.02248],
    [49, 0.01024],
    [50, 0.01164],
  ],
  "3k2ne": [
    [1, 0],
    [2, 0.10112],
    [3, 0.30075],
    [4, 0.69718],
    [5, 1.20112],
    [6, 1.90465],
    [7, 2.70696],
    [8, 3.69599],
    [9, 4.79597],
    [10, 6.10156],
    [11, 7.51278],
    [12, 8.79051],
    [13, 9.60336],
    [14, 9.98907],
    [15, 9.90581],
    [16, 9.40094],
    [17, 8.40219],
    [18, 7.00273],
    [19, 5.09223],
    [20, 2.79508],
    [21, 0],
    [22, 0],
    [23, 0],
    [24, 0],
    [25, 0],
    [26, 0],
    [27, 0],
    [28, 0],
    [29, 0],
    [30, 0],
    [31, 0],
    [32, 0],
    [33, 0],
    [34, 0],
    [35, 0],
    [36, 0],
    [37, 0],
    [38, 0],
    [39, 0],
    [40, 0],
    [41, 0],
    [42, 0],
    [43, 0],
    [44, 0],
    [45, 0],
    [46, 0],
    [47, 0],
    [48, 0],
    [49, 0],
    [50, 0],
  ],
  "3k2_e9": [
    [1, 0],
    [2, 0.099030079224063],
    [3, 0.29939023951219],
    [4, 0.69560055648045],
    [5, 1.2016609613288],
    [6, 1.8949415159532],
    [7, 2.6967521574017],
    [8, 3.6999929599944],
    [9, 4.8020538416431],
    [10, 5.7947546358037],
    [11, 6.3342250673801],
    [12, 6.5717352573882],
    [13, 6.3907851126281],
    [14, 5.9475947580758],
    [15, 5.1275041020033],
    [16, 4.0330432264346],
    [17, 2.5453920363136],
    [18, 3.3870427096342],
    [19, 3.8055730444584],
    [20, 3.7175229740184],
    [21, 3.5659128527303],
    [22, 3.3397826718261],
    [23, 3.0173224138579],
    [24, 2.6080320864257],
    [25, 2.1021916817533],
    [26, 1.486181188945],
    [27, 1.3073210458568],
    [28, 1.484731187785],
    [29, 1.4797411837929],
    [30, 1.3729710983769],
    [31, 1.2449909959928],
    [32, 1.1150708920567],
    [33, 0.96100076880062],
    [34, 0.78924063139251],
    [35, 0.59159047327238],
    [36, 0.44741035792829],
    [37, 0.43280034624028],
    [38, 0.45620036496029],
    [39, 0.42559034047227],
    [40, 0.38465030772025],
    [41, 0.34503027602422],
    [42, 0.29782023825619],
    [43, 0.24748019798416],
    [44, 0.19281015424812],
    [45, 0.14317011453609],
    [46, 0.12326009860808],
    [47, 0.12175009740008],
    [48, 0.11879009503208],
    [49, 0.10931008744807],
    [50, 0.094670075736061],
  ],
  "7k4": [
    [1, 0],
    [2, 0],
    [3, 0],
    [4, 0],
    [5, 0],
    [6, 0.0003000006000012],
    [7, 0.00078000156000312],
    [8, 0.0024200048400097],
    [9, 0.005760011520023],
    [10, 0.013100026200052],
    [11, 0.025700051400103],
    [12, 0.047340094680189],
    [13, 0.08508017016034],
    [14, 0.13933027866056],
    [15, 0.22260044520089],
    [16, 0.34469068938138],
    [17, 0.51056102112204],
    [18, 0.72702145404291],
    [19, 1.010302020604],
    [20, 1.3451926903854],
    [21, 1.753873507747],
    [22, 2.2190144380289],
    [23, 2.7136554273109],
    [24, 3.246886493773],
    [25, 3.743677487355],
    [26, 4.2360684721369],
    [27, 4.6183892367785],
    [28, 4.9084098168196],
    [29, 5.0577401154802],
    [30, 5.0693901387803],
    [31, 4.8949297898596],
    [32, 4.6192492384985],
    [33, 4.2645485290971],
    [34, 3.9214178428357],
    [35, 3.5776271552543],
    [36, 3.3799567599135],
    [37, 3.240166480333],
    [38, 3.1688463376927],
    [39, 2.992275984552],
    [40, 2.7886955773912],
    [41, 2.5251150502301],
    [42, 2.2323744647489],
    [43, 1.9519739039478],
    [44, 1.6972233944468],
    [45, 1.4693929387859],
    [46, 1.3095226190452],
    [47, 1.1987223974448],
    [48, 1.1224222448445],
    [49, 1.010862021724],
    [50, 0.90166180332361],
  ],
  "3k2e_e9": [
    [1, 0],
    [2, 0.00012000004800002],
    [3, 0.0031500012600005],
    [4, 0.17463006985203],
    [5, 0.47502019000808],
    [6, 1.0453204181282],
    [7, 1.7422406968963],
    [8, 2.7129910851964],
    [9, 3.8200115280046],
    [10, 5.1812020724808],
    [11, 6.194762477905],
    [12, 6.7555227022091],
    [13, 6.7460226984091],
    [14, 6.389212555685],
    [15, 5.5206322082529],
    [16, 4.2717417086967],
    [17, 2.5190410076164],
    [18, 3.4923813969526],
    [19, 4.0014016005606],
    [20, 3.9911315964526],
    [21, 3.9143015657206],
    [22, 3.7249314899726],
    [23, 3.3998213599285],
    [24, 2.9473111789245],
    [25, 2.3726209490484],
    [26, 1.6657006662803],
    [27, 1.4432405772962],
    [28, 1.6696806678723],
    [29, 1.6726306690523],
    [30, 1.5475406190162],
    [31, 1.4279405711762],
    [32, 1.2821205128482],
    [33, 1.1070004428002],
    [34, 0.90831036332415],
    [35, 0.67727027090811],
    [36, 0.51306020522408],
    [37, 0.50022020008808],
    [38, 0.52054020821608],
    [39, 0.49093019637208],
    [40, 0.44960017984007],
    [41, 0.40504016201606],
    [42, 0.34496013798406],
    [43, 0.28987011594805],
    [44, 0.22429008971604],
    [45, 0.16771006708403],
    [46, 0.14130005652002],
    [47, 0.14114005645602],
    [48, 0.13791005516402],
    [49, 0.12707005082802],
    [50, 0.11146004458402],
  ],
  "7k4e": [
    [1, 0],
    [2, 0],
    [3, 0],
    [4, 0],
    [5, 0],
    [6, 0],
    [7, 0],
    [8, 0],
    [9, 0.00020000044000097],
    [10, 0.00092000202400445],
    [11, 0.0022200048840107],
    [12, 0.0069100152020334],
    [13, 0.015470034034075],
    [14, 0.032530071566157],
    [15, 0.063690140118308],
    [16, 0.11411025104255],
    [17, 0.19840043648096],
    [18, 0.32190070818156],
    [19, 0.50600111320245],
    [20, 0.74783164522962],
    [21, 1.0688423514532],
    [22, 1.4690832319831],
    [23, 1.9487542872594],
    [24, 2.4909154800141],
    [25, 3.092086802591],
    [26, 3.6848181065998],
    [27, 4.2277193009825],
    [28, 4.7050303510668],
    [29, 5.0357310786084],
    [30, 5.1944514277931],
    [31, 5.1464013220829],
    [32, 4.9209508260918],
    [33, 4.5870200914442],
    [34, 4.2138892705564],
    [35, 3.8228384102445],
    [36, 3.6138279504215],
    [37, 3.514397731675],
    [38, 3.515707734557],
    [39, 3.3575573866263],
    [40, 3.1626469578233],
    [41, 2.9198364236401],
    [42, 2.6208157657947],
    [43, 2.2999050597911],
    [44, 1.9879943735876],
    [45, 1.7163937760663],
    [46, 1.5336233739714],
    [47, 1.4055230921508],
    [48, 1.3336029339265],
    [49, 1.2128826683419],
    [50, 1.0971524137353],
  ],
  "7k4ne": [
    [1, 0],
    [2, 0],
    [3, 0],
    [4, 0],
    [5, 0],
    [6, 0.0003],
    [7, 0.00075],
    [8, 0.00239],
    [9, 0.00566],
    [10, 0.01307],
    [11, 0.02639],
    [12, 0.04763],
    [13, 0.0843],
    [14, 0.14164],
    [15, 0.22541],
    [16, 0.34893],
    [17, 0.52413],
    [18, 0.75609],
    [19, 1.06606],
    [20, 1.44638],
    [21, 1.93572],
    [22, 2.50632],
    [23, 3.17903],
    [24, 3.90968],
    [25, 4.70451],
    [26, 5.51174],
    [27, 6.25846],
    [28, 6.96697],
    [29, 7.52131],
    [30, 7.86601],
    [31, 7.9532],
    [32, 7.77464],
    [33, 7.24929],
    [34, 6.4584],
    [35, 5.41232],
    [36, 4.20171],
    [37, 2.95328],
    [38, 1.81283],
    [39, 0.863],
    [40, 0.27237],
    [41, 0],
    [42, 0],
    [43, 0],
    [44, 0],
    [45, 0],
    [46, 0],
    [47, 0],
    [48, 0],
    [49, 0],
    [50, 0],
  ],
  "7k4_e9": [
    [1, 0],
    [2, 0],
    [3, 0],
    [4, 0],
    [5, 0],
    [6, 0.00032005290474515],
    [7, 0.0009301537544156],
    [8, 0.0022103653733962],
    [9, 0.0057509506321395],
    [10, 0.01272210296362],
    [11, 0.025124153022495],
    [12, 0.048157960510872],
    [13, 0.083453794912299],
    [14, 0.13710266307021],
    [15, 0.21955629265518],
    [16, 0.33302504904061],
    [17, 0.47960927941389],
    [18, 0.67003075608398],
    [19, 0.89868855321785],
    [20, 1.1665428295297],
    [21, 1.4616016027449],
    [22, 1.7707126988091],
    [23, 2.0742828789599],
    [24, 2.3595200286607],
    [25, 2.5935987218687],
    [26, 2.7976024436839],
    [27, 2.9057903271411],
    [28, 2.970711058538],
    [29, 3.0106476600582],
    [30, 3.0311510492684],
    [31, 3.0550449989383],
    [32, 3.1400690534145],
    [33, 3.2481369170324],
    [34, 3.3596453493763],
    [35, 3.3348812558716],
    [36, 3.2312741296136],
    [37, 3.1333479424149],
    [38, 2.9915845089193],
    [39, 2.8288076018966],
    [40, 2.7135885561883],
    [41, 2.6172926384731],
    [42, 2.549141373069],
    [43, 2.5121652609176],
    [44, 2.4284514230202],
    [45, 2.2861579019012],
    [46, 2.1372932945816],
    [47, 1.9858882673306],
    [48, 1.8416944320896],
    [49, 1.7110228320741],
    [50, 1.5969139698792],
  ],
  "7k4e_e9": [
    [1, 0],
    [2, 0],
    [3, 0],
    [4, 0],
    [5, 0],
    [6, 0],
    [7, 0],
    [8, 0],
    [9, 0.00021004751274738],
    [10, 0.00085019231350131],
    [11, 0.0024605565778979],
    [12, 0.0067315226704281],
    [13, 0.01556352046833],
    [14, 0.03292744818878],
    [15, 0.06253414522365],
    [16, 0.11450590123486],
    [17, 0.19221347868888],
    [18, 0.30925995460173],
    [19, 0.4688560552397],
    [20, 0.67215204079163],
    [21, 0.93121063984673],
    [22, 1.2297481690358],
    [23, 1.552951277579],
    [24, 1.8725835784054],
    [25, 2.1654898338004],
    [26, 2.4310298989631],
    [27, 2.6085000427097],
    [28, 2.7168745570248],
    [29, 2.7658056252324],
    [30, 2.8064248132928],
    [31, 2.8318405623352],
    [32, 2.9676112736701],
    [33, 3.1359193449558],
    [34, 3.3360446132915],
    [35, 3.3721427786965],
    [36, 3.3339541404266],
    [37, 3.2381024587762],
    [38, 3.1404303653486],
    [39, 3.0031193055869],
    [40, 2.857536374728],
    [41, 2.7775482814213],
    [42, 2.729387387427],
    [43, 2.7153642153855],
    [44, 2.6646527444508],
    [45, 2.5452357323227],
    [46, 2.3962020208971],
    [47, 2.2401967325009],
    [48, 2.0969543310697],
    [49, 1.9476905676064],
    [50, 1.8080189738919],
  ],
};

const getP = (args) => getProbability(rawData, args);

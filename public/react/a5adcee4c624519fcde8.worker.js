!function(n){var r={};function t(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return n[e].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=n,t.c=r,t.d=function(n,r,e){t.o(n,r)||Object.defineProperty(n,r,{enumerable:!0,get:e})},t.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,r){if(1&r&&(n=t(n)),8&r)return n;if(4&r&&"object"===typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&r&&"string"!=typeof n)for(var i in n)t.d(e,i,function(r){return n[r]}.bind(null,i));return e},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,r){return Object.prototype.hasOwnProperty.call(n,r)},t.p="/react/",t(t.s=0)}([function(n,r,t){"use strict";function e(n,r){(null==r||r>n.length)&&(r=n.length);for(var t=0,e=new Array(r);t<r;t++)e[t]=n[t];return e}function i(n){return function(n){if(Array.isArray(n))return e(n)}(n)||function(n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}(n)||function(n,r){if(n){if("string"===typeof n)return e(n,r);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t.r(r),t.d(r,"asyncCumulativeSuccess",(function(){return b}));var o=function(n){var r={};return n.forEach((function(n){r[n]?r[n]+=1:r[n]=1})),u(n.length)/Object.values(r).reduce((function(n,r){return n*u(r)}),1)},u=function n(r){if(r<0)throw new Error("n must be >= 0");return 0===r?1:r*n(r-1)},l=function(n){return 0===n?.5:Math.pow(1/6,n-1)*(1/3+1/6*.5)},c=function(n){return 0===n?5/12:Math.pow(1/6,n-1)*(5/12+1/6*(5/12))},s=function(n){return 0===n?5/6:1===n?1/6:0},a=function(n){return 0===n?2/3:Math.pow(1/12,n-1)*(1/4+1/12*(2/3))},f=function(n){var r=n.ring,t=n.skill,e=n.n,o=n.keptDiceCount,u=function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=r.maxCardinality,e=void 0===t?null:t,o=r.maxValue,u=void 0===o?null:o,l=[],c=function r(t){if(!(null!==e&&t.length>e)&&(null===u||!t.some((function(n){return n>u})))){var o=t.reduce((function(n,r){return n+r}),0);if(o<n){var c=[].concat(i(t),[1]),s=i(t);s[s.length-1]=s[s.length-1]+1,r(c),r(s)}o===n&&l.push(t)}};return c([1]),l}(e,{maxCardinality:void 0===o?r:o}),l=[];return u.forEach((function(n){(function(n){var r=n.ring,t=n.skill,e=n.size;if(e>r.length+t.length)throw new Error("Out of bounds");if(r<1)throw new Error("Not possible for a standard roll thus not implemented");var o=[];return function n(u){u.length<e&&(u.filter((function(n){return"r"===n})).length<r&&n([].concat(i(u),["r"])),u.filter((function(n){return"s"===n})).length<t&&n([].concat(i(u),["s"]))),u.length===e&&o.push(u)}([]),p(o.map((function(n){return i(n).sort()}))).map((function(n){return{ring:n.filter((function(n){return"r"===n})).length,skill:n.filter((function(n){return"s"===n})).length}}))})({ring:r,skill:t,size:n.length}).forEach((function(r){for(var t=r.ring,e=r.skill,i=new Array(t),o=new Array(e),u=0;u<t;u++)i[u]=n[u];for(var c=0;c<e;c++)o[c]=n[t+c];l.push({rings:i,skills:o})}))})),l},h=function(n){for(var r=n.threshold,t=n.size,e={1:[]},o=1;o<=r;o++)e[1].push([o]);for(var u=2;u<=t;u++){e[u]=[];for(var l=1;l<=r;l++)for(var c=0;c<e[u-1].length;c++)e[u-1][c][0]<l||e[u].push([l].concat(i(e[u-1][c])))}for(var s=[new Array(t).fill(0)],a=function(n){e[n].forEach((function(r){s.push([].concat(i(new Array(t-n).fill(0)),i(r)))}))},f=1;f<=t;f++)a(f);return s},g=function(n,r){if(n.length!==r.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==r[t])return!1;return!0},p=function(n){for(var r=i(n).map((function(n){return n.sort()})),t=[],e=[],o=0;o<r.length;o++)if(!e.includes(o)){for(var u=o+1;u<n.length;u++)g(r[o],r[u])&&e.push(u);t.push(r[o])}return t},d=function(n){var r=n.comb,t=n.diceP,e=n.diceCount;if(r.length>e)return 0;var u=1;return r.forEach((function(n){u*=t(n)})),u*=Math.pow(t(0),e-r.length),u*=o([].concat(i(r),i(new Array(e-r.length).fill(0))))},v=function(n,r){return n.reduce((function(n,t){return n*r(t)}),1)},m=function(n,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=t.max,o=void 0===e?null:e;return null===o?n.reduce((function(n,r){return n+r}),0)>=r:i(n).sort().reverse().slice(0,o).reduce((function(n,r){return n+r}),0)>=r},y=function(n){var r=n.ring,t=n.skill,e=n.tn,u=n.options,p=u.compromised,y=void 0!==p&&p,k=u.keptDiceCount,b=void 0===k?r:k,w=y?s:l,M=y?a:c;if(0===e)return Math.pow(w(0),r)*Math.pow(M(0),t);var C=function(n){for(var r=n.ring,t=n.skill,e=n.n,i=n.keptDiceCount,o=f({ring:r,skill:t,n:e,keptDiceCount:i}).map((function(n){var r=n.rings,t=n.skills;return{rings:r.sort(),skills:t.sort()}})),u=[],l=[],c=0;c<o.length;c++)if(!l.includes(c)){for(var s=c+1;s<o.length;s++)g(o[c].rings,o[s].rings)&&g(o[c].skills,o[s].skills)&&l.push(s);u.push(o[c])}return u}({ring:r,skill:t,n:e,keptDiceCount:b}),E=C.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length<b})).reduce((function(n,e){var i=e.rings,o=e.skills;return n+d({comb:i,diceP:w,diceCount:r})*d({comb:o,diceP:M,diceCount:t})}),0),P=C.filter((function(n){var r=n.rings,t=n.skills;return r.length+t.length===b})),j=P.filter((function(n){return 0===n.skills.length})).reduce((function(n,r){var e=r.rings,u=1;return u*=v(e,w),u*=o(e),n+(u*=h({threshold:Math.min.apply(Math,i(e)),size:t}).reduce((function(n,r){return n+v(r,M)*o(r)}),0))}),0),A=P.filter((function(n){return 0===n.rings.length})).reduce((function(n,u){var l=u.skills,c=1;return c*=h({threshold:Math.min.apply(Math,i(l)),size:r}).filter((function(n){return!m(n,e)})).reduce((function(n,r){return n+v(r,w)*o(r)}),0),c*=v(l,M),n+(c*=h({threshold:Math.min.apply(Math,i(l)),size:t-l.length}).reduce((function(n,r){return n+v(r,M)*o([].concat(i(l),i(r)))}),0))}),0),O=P.filter((function(n){var r=n.rings,t=n.skills;return r.length>0&&t.length>0})),S=[],x=function(n){S.some((function(r){var t=r.rings,e=r.skills;return g(i(t).sort(),i(n.rings).sort())&&g(i(e).sort(),i(n.skills).sort())}))||S.push(n)};return O.forEach((function(n){var o=n.rings,u=n.skills,l=Math.min.apply(Math,i(o).concat(i(u)));h({threshold:l,size:r-o.length}).map((function(n){return[].concat(i(o),i(n))})).filter((function(n){return!m(n,e)})).forEach((function(n){if(t===u.length)return x({rings:n,skills:u});h({threshold:l,size:t-u.length}).map((function(n){return[].concat(i(u),i(n))})).filter((function(n){return!m(n,e,{max:b})})).forEach((function(r){x({rings:n,skills:r})}))}))})),E+j+A+S.reduce((function(n,r){var t=r.rings,e=r.skills;return n+v(t,w)*o(t)*v(e,M)*o(e)}),0)},k=function(n){var r=n.ring,t=n.skill,e=n.tn,i=n.options,o=void 0===i?{}:i,u=o.keptDiceCount,l=void 0===u?r:u;if(l<=0)return e<=0?1:0;if(l>r+t)throw new Error("Cannot keep more dice than available");if(l<r)throw new Error("Not implemented");for(var c=1,s=0;s<e;s++)c-=y({ring:r,skill:t,tn:s,options:o});return c},b=function(n){postMessage({type:"custom",params:n,result:k(n)})};addEventListener("message",(function(n){var t,e=n.data,i=e.type,o=e.method,u=e.id,l=e.params;"RPC"===i&&o&&((t=r[o])?Promise.resolve().then((function(){return t.apply(r,l)})):Promise.reject("No such method")).then((function(n){postMessage({type:"RPC",id:u,result:n})})).catch((function(n){var r={message:n};n.stack&&(r.message=n.message,r.stack=n.stack,r.name=n.name),postMessage({type:"RPC",id:u,error:r})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=a5adcee4c624519fcde8.worker.js.map